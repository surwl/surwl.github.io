---
title: "Practical Malware Analysis 9-1"
categories:
  - Practical Malware Analysis
tags:
  - Malware
layout: archive
layout: single
author_profile: true
sidebar:
  nav: "docs"
toc: true
toc_sticky: true
toc_label: "목차"
---

# 실습 9-1

실습 환경 : Vmware (Windows 7 32 bit)
사용한 툴 : IDA Free, Ollydbg

이번 악성코드는 실습 3-4에서 IDA free를 사용해 분석을 해보았고 이번엔 Ollydbg를 사용해 분석을 진행해 봤다.

![lab9-1 1](https://user-images.githubusercontent.com/91646923/135745503-5a849801-79eb-410f-bce2-3071e5f57a61.JPG)

![lab9-1 2](https://user-images.githubusercontent.com/91646923/135745507-101bb313-c97a-48f7-9c37-bba1e95c5a3a.JPG)

ollydbg로 프로그램을 실행하면 처음에 주소 0040896에서 멈추는 것을 확인할 수 있다. 계속 분석을 진행해보면 00403945에서 00402AF0로 점프하는 것을 확인할 수 있는데
여기가 바로 프로그램의 OEP이다. 이제 00402AF0를 분석해보면

![lab9-1 3](https://user-images.githubusercontent.com/91646923/135746174-ee65c1ef-2eb7-4b89-ab98-5df094722915.JPG)

처음에 스택에 값을 설정하고 프로그램 실행시 입력한 파라미터의 값이 1 즉 argc 값이 1이면(프로그램 실행시 아무런 인자 값을 주지 않으면) 점프하지 않고 401000함수를 실행하는데
분석을 해보면

![lab9-1 4](https://user-images.githubusercontent.com/91646923/135746344-0b6e6b1c-98a9-4f47-9526-eb23ad7503b7.JPG)

RegOpenKeyEx 함수를 사용하여 SOFTWARE\Microsoft \XPS 레지스트리 오픈을 시도하는데 레지스트리 키가 존재하지 않으므로 0이 아닌 값을 반환하여 점프하지 않고
XOR eax, eax를 통해 eax값을 0으로 초기화 한 후에 함수를 종료한다. 이제 다시 돌아가서 살펴보면

![lab9-1 5](https://user-images.githubusercontent.com/91646923/135747061-d292d273-70f9-4367-93b2-d10396eb24e4.JPG)

위에서 0을 반환하고 함수를 종료했기 때문에 jz문에 의해 00402B13으로 점프하게 되고 00402410 함수를 실행하는데 이 함수를 살펴보면

![lab9-1 6](https://user-images.githubusercontent.com/91646923/135747227-7b31cbe5-13f4-4faf-9782-b16797667c3a.JPG)

![lab9-1 7](https://user-images.githubusercontent.com/91646923/135747236-9cfa870e-714e-49b3-8e96-61312d694bab.JPG)

![lab9-1 8](https://user-images.githubusercontent.com/91646923/135747242-5ca8c1bf-4eac-47c6-83ee-9f25bc03f3bd.JPG)

GetModuleFileName 함수를 사용하여 현재 파일의 경로를 가져오고

![lab9-1 10](https://user-images.githubusercontent.com/91646923/135747441-030c9805-aae9-460b-ac16-809ec0acfc35.JPG)
![lab9-1 9](https://user-images.githubusercontent.com/91646923/135747447-2478e2e7-cb2d-42d1-afc9-9503bfbb0f6d.JPG)
