---
title: "Practical Malware Analysis 9-2"
categories:
  - Practical Malware Analysis
tags:
  - Malware
layout: archive
layout: single
author_profile: true
sidebar:
  nav: "docs"
toc: true
toc_sticky: true
toc_label: "목차"
---

# 실습 9-2

실습 환경 : Vmware (Windows 7 32 bit)

사용한 툴 : Ollydbg, IDA Free, Strings

프로그램을 분석하기 전에 Strings를 사용하여 문자열을 확인해 보면

![lab9-2 2](https://user-images.githubusercontent.com/91646923/135800727-199bc90a-f33b-43c4-b303-abd0eaf01141.JPG)

눈에 띄는 문자열은 cmd 하나만 볼 수 있었다.

이제 IDA를 사용하여 프로그램을 열고 살펴보면

![lab9-2 2](https://user-images.githubusercontent.com/91646923/135800780-75bd6381-b12d-4c3d-af91-77f080fda35c.JPG)

프로그램 main의 위치를 확인할 수 있다

main 함수의 위치를 확인했으니 Ollydbg로 프로그램을 살펴보면

![lab9-2 3](https://user-images.githubusercontent.com/91646923/135801493-a1dd4634-0535-4f37-ad0b-2906f5a726ab.JPG)

00401626 주소에서 main 함수를 호출하는 것을 확인할 수 있고 이곳에 브레이크 포인트를 걸고 실행한 뒤 F7로 함수 내부에 들어가 main을 분석해보면

![lab9-2 4](https://user-images.githubusercontent.com/91646923/135801596-80330eb0-5010-4b9e-8da7-783405efeb1e.JPG)

이렇게 스택에 무엇인가 값을 구성하고 있는 것을 확인할 수 있다. 어떠한 값이 저장되는지 알아보기 위해 00401133에 Follow in Dump -> Memory address 를 사용한 뒤에 프로그램 진행 후 살펴보면

![lab9-2 5](https://user-images.githubusercontent.com/91646923/135803081-7cce446c-a955-4ec2-bb5d-1140d6513354.JPG)

위와 같이 1qaz2wsx3edc ocl.exe를 확인할 수 있었다.

분석을 진행해보면

![lab9-2 6](https://user-images.githubusercontent.com/91646923/135803468-cebaee72-0e45-4f32-9a32-6e6ac633c912.JPG)

![lab9-2 7](https://user-images.githubusercontent.com/91646923/135803841-44a18c16-b06a-4979-b039-c183fa521685.JPG)

특정 위치의 메로리를 0으로 초기화 시키고 그 구간에 GetModuleFileName 함수로 가져온 실행파일의 경로를 넣는 것을 확인할 수 있었다.

![lab9-2 8](https://user-images.githubusercontent.com/91646923/135804104-ab0c7380-f21e-4187-a206-b39ddf0fb2f9.JPG)

![lab9-2 9](https://user-images.githubusercontent.com/91646923/135804111-688057ac-0916-4253-ad22-77aaeddbe3a6.JPG)

![lab9-2 10](https://user-images.githubusercontent.com/91646923/135804442-1d37b946-6d1e-45a0-a8c5-3af942b431cb.JPG)

분석을 진행해보니 00401550함수를 호출하는 것을 볼 수 있었는데 이를 IDA로 살펴보니 strrchr 함수인 것을 알 수 있었다.
Ollydbg로 다시 돌아와 어떤 역할을 하는지 실행을 해보니 /(0x5c)와 GetModuleFileName 함수로 가져온 실행 파일경로를 파라미터로 받아 뒤에서 부터 /를 검색하여 실행 파일의 이름을
가져와 eax에 반환 하는 것을 확인하 수 있었다.
